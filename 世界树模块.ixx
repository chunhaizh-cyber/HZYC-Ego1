export module 世界树模块;

import 主信息定义模块;
import 语素模块;

export class 世界树类 {
    链表模板<存在节点主信息类*> 存在库;
    链表模板<特征节点主信息类*> 特征库;
    链表模板<场景节点主信息类*> 场景库;
    链表模板<基础信息基类*>     全局库;

    场景节点类* 当前场景 = nullptr;
    存在节点类* 自我 = nullptr;

public:
    世界树类() {
        创建场景(L"初始场景");
        自我 = 添加存在(L"我");
    }

    存在节点类* 添加存在(const std::wstring& 名) {
        auto* 信息 = new 存在节点主信息类();
        信息->名称 = 创建词性节点(名);
        auto* 节点 = 存在库.添加节点(信息);
        全局库.添加节点(信息);
        return 节点;
    }

    特征节点类* 添加标量特征(存在节点类* 主体, const std::wstring& 名称, double 值) {
        auto* 信息 = new 特征节点主信息类();
        信息->名称 = 创建词性节点(名称);
        信息->值 = 值;
        信息->主体 = 主体;
        auto* 节点 = 特征库.添加节点(信息);
        全局库.添加节点(信息);

        // 自动触发比较（核心！）
        自动生成比较二次特征(主体, 名称, 值);
        return 节点;
    }

    场景节点类* 创建场景(const std::wstring& 名) {
        auto* 信息 = new 场景节点主信息类();
        信息->名称 = 创建词性节点(名);
        auto* 节点 = 场景库.添加节点(信息);
        全局库.添加节点(信息);
        当前场景 = 节点;
        return 节点;
    }

    存在节点类* 获取自我() const { return 自我; }
    场景节点类* 获取当前场景() const { return 当前场景; }
};